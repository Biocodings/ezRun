---
title: "`r paste('Two groups analysis:', param$comparison)`"
author: "Functional Genomics Center Zurich"
output: 
  html_document:
    self_contained: false
    includes:
      in_header: fgcz_header.html
    css: fgcz.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
## This report requires objects: se, param, output, deResult
require(knitr)
require(kableExtra)
require(SummarizedExperiment)
```
Started on `r format(Sys.time(), "%Y-%m-%d %H:%M:%S")`

## TwoGroupsAnalysis_Result {.tabset}

### Settings

```{r setting, echo=FALSE}
kable(makeCountResultSummary(param, se), row.names=TRUE, format="html") %>%
  kable_styling(bootstrap_options = "striped", full_width = F,
                position = "left")
```

### Input Dataset
```{r input, echo=FALSE}
dataset <- data.frame(colData(se), check.names=FALSE, stringsAsFactors=FALSE)
ezInteractiveTableRmd(values=dataset, digits=4)
```

### Result Summary
```{r summary, echo=FALSE}
settings = character()
settings["Number of features:"] = nrow(se)
if (!is.null(rowData(se)$isPresentProbe)){
  settings["Number of features with counts above threshold:"] = 
    sum(rowData(se)$isPresentProbe)
}
knitr::kable(as.data.frame(settings), format="html", 
             col.names="Number", row.names=TRUE) %>%
    kable_styling(bootstrap_options = "striped", full_width = F,
                  position = "left")
```

#### Number of significants by p-value and fold-change
```{r gene table, echo=FALSE}
knitr::kable(makeSignificantCounts(se), row.names=TRUE,  format="html") %>%
  kable_styling(bootstrap_options = "striped", full_width = F, 
                position = "left")
```

Full result table for opening with a spreadsheet program 
(e.g. Excel: when opening with Excel, make sure that the Gene symbols are loaded into a column formatted as 'text' that prevents conversion of the symbols to dates).

```{r result live report, echo=FALSE}
resultFile <- makeResultFile(param, se)

ezWrite.table(colData(se)[, "sf", drop=FALSE],
              file="scalingfactors.txt", head="Name", digits=4)

liveReportLink = output$getColumn("Live Report")
deResult$saveToFile(basename(output$getColumn("Live Report")))
```

[`r resultFile$resultZip`](`r resultFile$resultZip`)

[Live Report and Visualizations](`r liveReportLink`)

### Inspection of significant genes

#### Between-group Comparison
```{r scatter comparison, echo=FALSE, warning=FALSE}
## warning=FALSE because FDR contains NA. Shall we make them always 1?
scatters <- addTestScatterPlotsPlotly(param, se)
include_graphics(scatters$scatterPng, dpi=72*1.5)  ## To make legend more visible on non-retinal display
```

[Plot in pdf](`r scatters$scatterPdf`)

[Interactive comparison plot (With thousands of genes, it can be slow and requires a modern web brwoser for best javascript performance!)](`r scatters$scatterHtml`)

#### Volcano plot with p-value
```{r volcano p-value, echo=FALSE}
include_graphics(scatters$volcanoPng, dpi=72*1.5)  ## To make legend more visible on non-retinal display
```

[Plot in pdf](`r scatters$volcanoPdf`)

[Interactive comparison plot (With thousands of genes, it can be slow and requires a modern web brwoser for best javascript performance!)](`r scatters$volcanoHtml`)

#### Volcano plot with FDR
```{r volcano FDR, echo=FALSE}
include_graphics(scatters$volcanoFDRPng, dpi=72*1.5)  ## To make legend more visible on non-retinal display
```

[Plot in pdf](`r scatters$volcanoFDRPdf`)

[Interactive comparison plot (With thousands of genes, it can be slow and requires a modern web brwoser for best javascript performance!)](`r scatters$volcanoFDRHtml`)
